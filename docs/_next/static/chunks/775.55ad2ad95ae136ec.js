"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[775],{2775:function(e,t,a){async function r(e){console.log("[ImagePreprocessor] Starting preprocessing...");try{let t=await new Promise((t,a)=>{let r=new Image;r.onload=()=>t(r),r.onerror=a,r.src=URL.createObjectURL(e)}),a=document.createElement("canvas"),r=a.getContext("2d",{willReadFrequently:!0});a.width=t.width,a.height=t.height;let o=await n(e);return console.log("[ImagePreprocessor] EXIF orientation:",o),function(e,t,a){let r=t.width,n=t.height;switch(e.setTransform(1,0,0,1,0,0),a){case 2:e.translate(r,0),e.scale(-1,1);break;case 3:e.translate(r,n),e.rotate(Math.PI);break;case 4:e.translate(0,n),e.scale(1,-1);break;case 5:e.canvas.width=n,e.canvas.height=r,e.rotate(Math.PI/2),e.scale(1,-1);break;case 6:e.canvas.width=n,e.canvas.height=r,e.translate(n,0),e.rotate(Math.PI/2);break;case 7:e.canvas.width=n,e.canvas.height=r,e.translate(0,r),e.rotate(-Math.PI/2),e.scale(1,-1);break;case 8:e.canvas.width=n,e.canvas.height=r,e.translate(0,r),e.rotate(-Math.PI/2)}e.drawImage(t,0,0)}(r,t,o),function(e,t,a){let r=e.getImageData(0,0,t,a),n=r.data,o=Array(256).fill(0);for(let e=0;e<n.length;e+=4){let t=Math.round((n[e]+n[e+1]+n[e+2])/3);o[t]++}let l=t*a,i=0,s=255,c=0;for(let e=0;e<256;e++)if((c+=o[e])>.01*l){i=e;break}c=0;for(let e=255;e>=0;e--)if((c+=o[e])>.01*l){s=e;break}let h=s-i;if(h>0)for(let e=0;e<n.length;e+=4)n[e]=Math.min(255,Math.max(0,(n[e]-i)*255/h)),n[e+1]=Math.min(255,Math.max(0,(n[e+1]-i)*255/h)),n[e+2]=Math.min(255,Math.max(0,(n[e+2]-i)*255/h));e.putImageData(r,0,0)}(r,a.width,a.height),function(e,t,a){let r=e.getImageData(0,0,t,a),n=r.data;for(let e=0;e<n.length;e+=4){let t=Math.round(.299*n[e]+.587*n[e+1]+.114*n[e+2]);n[e]=t,n[e+1]=t,n[e+2]=t}e.putImageData(r,0,0)}(r,a.width,a.height),function(e,t,a){let r=e.getImageData(0,0,t,a),n=r.data,o=new Uint8ClampedArray(n),l=[0,-1,0,-1,5,-1,0,-1,0];for(let e=1;e<a-1;e++)for(let a=1;a<t-1;a++)for(let r=0;r<3;r++){let i=0;for(let o=-1;o<=1;o++)for(let s=-1;s<=1;s++){let c=((e+o)*t+(a+s))*4+r,h=(o+1)*3+(s+1);i+=n[c]*l[h]}o[(e*t+a)*4+r]=Math.min(255,Math.max(0,i))}for(let e=0;e<n.length;e++)n[e]=o[e];e.putImageData(r,0,0)}(r,a.width,a.height),console.log("[ImagePreprocessor] Preprocessing complete"),new Promise(e=>{a.toBlob(t=>{e(t)},"image/jpeg",.95)})}catch(t){return console.error("[ImagePreprocessor] Error:",t),e}}async function n(e){try{let t=await e.arrayBuffer(),a=new DataView(t);if(65496!==a.getUint16(0,!1))return 1;let r=a.byteLength,n=2;for(;n<r;){let e=a.getUint16(n,!1);if(n+=2,65505===e){let e=n+10;if(e+8>r)break;let t=18761===a.getUint16(e,!1),o=e+a.getUint32(e+4,t),l=a.getUint16(o,t);for(let e=0;e<l;e++){let r=o+2+12*e,n=a.getUint16(r,t);if(274===n)return a.getUint16(r+8,t)}}let t=a.getUint16(n,!1);n+=t}}catch(e){console.warn("[ImagePreprocessor] Could not read EXIF:",e.message)}return 1}a.d(t,{preprocessImage:function(){return r}})}}]);