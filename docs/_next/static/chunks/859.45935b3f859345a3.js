"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[859],{2859:function(e,t,n){n.d(t,{processDocument:function(){return r}});var s=n(9960);async function o(e){let t=null;try{var n,o,i,r;console.log("[OCR] Starting text extraction..."),console.log("[OCR] File type:",e.type,"Size:",e.size,"bytes"),t=await (0,s.createWorker)("eng",1,{logger:e=>{"recognizing text"===e.status?console.log("[OCR] Progress: ".concat(Math.round(100*e.progress),"%")):"loading tesseract core"===e.status?console.log("[OCR] Loading Tesseract core..."):"initializing tesseract"===e.status?console.log("[OCR] Initializing Tesseract..."):"initializing api"===e.status?console.log("[OCR] Initializing API..."):"loading language traineddata"===e.status&&console.log("[OCR] Loading language data...")},workerPath:"https://cdn.jsdelivr.net/npm/tesseract.js@5.1.1/dist/worker.min.js",langPath:"https://tessdata.projectnaptha.com/4.0.0",corePath:"https://cdn.jsdelivr.net/npm/tesseract.js-core@5.0.0/tesseract-core.wasm.js"}),console.log("[OCR] Worker initialized, starting recognition...");let{data:a}=await t.recognize(e);if(console.log("[OCR] Extraction complete"),console.log("[OCR] Confidence: ".concat(a.confidence,"%")),console.log("[OCR] Text length: ".concat((null===(n=a.text)||void 0===n?void 0:n.length)||0," characters")),console.log("[OCR] Words detected: ".concat((null===(o=a.words)||void 0===o?void 0:o.length)||0)),!a.text||0===a.text.trim().length)return console.warn("[OCR] No text detected in image"),await t.terminate(),{text:"",confidence:0,words:0,lines:0,error:"No text detected in image. Please ensure the image is clear and contains readable text."};return await t.terminate(),{text:a.text,confidence:a.confidence/100,words:(null===(i=a.words)||void 0===i?void 0:i.length)||0,lines:(null===(r=a.lines)||void 0===r?void 0:r.length)||0}}catch(e){if(console.error("[OCR] Error:",e),console.error("[OCR] Error stack:",e.stack),t)try{await t.terminate()}catch(e){console.error("[OCR] Error terminating worker:",e)}throw Error("Failed to extract text: ".concat(e.message))}}async function i(e){return console.warn("[PDF] Client-side PDF processing not available in browser."),console.log("[PDF] Please use Google Apps Script backend for PDF processing."),{text:"",confidence:0,pages:0,error:"PDF processing requires server-side processing. Use Google Apps Script backend."}}async function r(e,t){let n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"general";console.log("[OCR] Processing ".concat(s," document..."));let r=function(e,t){let n=e.split("\n").filter(e=>e.trim());switch(t){case"lab":return function(e){let t=[],n=/([A-Za-z\s]+)\s*[:-]?\s*([\d.]+)\s*([a-zA-Z/%]+)?/;return e.forEach(e=>{let s=e.match(n);s&&t.push({test:s[1].trim(),value:s[2],unit:s[3]||"",raw:e})}),{type:"lab",results:t,totalTests:t.length}}(n);case"imaging":let s,o,i,r;return s=[],o="",i=!1,r=!1,n.forEach(e=>{let t=e.toLowerCase();t.includes("findings")||t.includes("technique")?(i=!0,r=!1):t.includes("impression")||t.includes("conclusion")?(r=!0,i=!1):i&&e.trim()?s.push(e.trim()):r&&e.trim()&&(o+=e.trim()+" ")}),{type:"imaging",findings:s,impression:o.trim(),lineCount:n.length};case"note":return function(e){let t={subjective:[],objective:[],assessment:[],plan:[]},n=null;return e.forEach(e=>{let s=e.toLowerCase();s.includes("subjective")||s.includes("history")?n="subjective":s.includes("objective")||s.includes("physical exam")?n="objective":s.includes("assessment")||s.includes("diagnosis")?n="assessment":s.includes("plan")||s.includes("treatment")?n="plan":n&&e.trim()&&t[n].push(e.trim())}),{type:"note",sections:t,format:"SOAP"}}(n);default:return{lines:n,summary:e.substring(0,200)}}}((n="application/pdf"===t||"object"==typeof e&&"application/pdf"===e.type?await i(e):await o(e)).text,s);return{fullText:n.text,rawText:n.text,confidence:n.confidence,type:s,structuredData:r,parsed:r,metadata:{fileName:e.name||"document",fileSize:e.size||e.length||0,fileType:t||e.type,pages:n.pages,extractedAt:new Date().toISOString()}}}}}]);