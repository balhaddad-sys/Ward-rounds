(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[673],{7900:function(e,t,s){Promise.resolve().then(s.bind(s,7190))},7190:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var l=s(7437),a=s(2265),r=s(9376),n=s(166),i=s(5725);let o=(0,n.default)(()=>s.e(785).then(s.t.bind(s,4785,23)),{loadableGenerated:{webpack:()=>[4785]},ssr:!1});function c(e){let{onCapture:t}=e,[s,r]=(0,a.useState)("camera"),[n,c]=(0,a.useState)(!1),[d,x]=(0,a.useState)(null),u=(0,a.useRef)(null),m=(0,a.useCallback)(async()=>{if(u.current){c(!0);try{let e=u.current.getScreenshot({width:1920,height:1080});if(!e)throw Error("Failed to capture image");let s=await fetch(e),l=await s.blob(),a=new File([l],"scan-".concat(Date.now(),".jpg"),{type:"image/jpeg"});t(a,"camera")}catch(e){console.error("Capture error:",e),alert("Failed to capture photo. Please try again.")}finally{c(!1)}}},[t]),h=(0,a.useCallback)(e=>{e[0]&&t(e[0],"upload")},[t]),{getRootProps:p,getInputProps:b,isDragActive:g}=(0,i.uI)({onDrop:h,accept:{"image/*":[".jpeg",".jpg",".png"],"application/pdf":[".pdf"]},maxFiles:1,multiple:!1});return(0,l.jsxs)("div",{className:"flex flex-col h-full bg-slate-900",children:[(0,l.jsxs)("div",{className:"flex gap-2 p-4 bg-slate-800",children:[(0,l.jsx)("button",{onClick:()=>r("camera"),className:"flex-1 py-3 rounded-xl font-medium transition-colors ".concat("camera"===s?"bg-blue-600 text-white":"bg-slate-700 text-slate-300"),children:"\uD83D\uDCF7 Camera"}),(0,l.jsx)("button",{onClick:()=>r("upload"),className:"flex-1 py-3 rounded-xl font-medium transition-colors ".concat("upload"===s?"bg-blue-600 text-white":"bg-slate-700 text-slate-300"),children:"\uD83D\uDCC1 Upload"})]}),"camera"===s?(0,l.jsx)("div",{className:"relative flex-1 bg-black",children:d?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-white p-8",children:[(0,l.jsx)("span",{className:"text-6xl mb-4",children:"\uD83D\uDCF7"}),(0,l.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Camera Access Needed"}),(0,l.jsx)("p",{className:"text-sm text-slate-400 text-center mb-4",children:d}),(0,l.jsx)("button",{onClick:()=>r("upload"),className:"px-6 py-3 bg-blue-600 text-white rounded-xl font-medium",children:"Use File Upload Instead"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o,{ref:u,audio:!1,screenshotFormat:"image/jpeg",screenshotQuality:.95,videoConstraints:{facingMode:{ideal:"environment"},width:{ideal:1920},height:{ideal:1080}},className:"w-full h-full object-cover",onUserMediaError:e=>{console.error("Camera error:",e),x("Unable to access camera. Please check permissions or use file upload.")}}),(0,l.jsx)("div",{className:"absolute inset-0 pointer-events-none",children:(0,l.jsxs)("div",{className:"absolute inset-8 border-2 border-white/50 rounded-lg",children:[(0,l.jsx)("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 text-white text-sm bg-black/70 px-3 py-1 rounded-full whitespace-nowrap",children:"Align document within frame"}),(0,l.jsx)("div",{className:"absolute -top-1 -left-1 w-6 h-6 border-t-4 border-l-4 border-blue-500"}),(0,l.jsx)("div",{className:"absolute -top-1 -right-1 w-6 h-6 border-t-4 border-r-4 border-blue-500"}),(0,l.jsx)("div",{className:"absolute -bottom-1 -left-1 w-6 h-6 border-b-4 border-l-4 border-blue-500"}),(0,l.jsx)("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 border-b-4 border-r-4 border-blue-500"})]})}),(0,l.jsxs)("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center gap-4 items-center",children:[(0,l.jsx)("button",{className:"w-12 h-12 rounded-full bg-slate-800/80 backdrop-blur flex items-center justify-center text-white",children:"⚡"}),(0,l.jsx)("button",{onClick:m,disabled:n,className:"w-20 h-20 rounded-full bg-white border-4 border-blue-600 flex items-center justify-center shadow-2xl active:scale-95 transition-transform disabled:opacity-50",children:n?(0,l.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}):(0,l.jsx)("div",{className:"w-14 h-14 rounded-full bg-blue-600"})}),(0,l.jsx)("button",{onClick:()=>r("upload"),className:"w-12 h-12 rounded-full bg-slate-800/80 backdrop-blur flex items-center justify-center text-white",children:"\uD83D\uDDBC️"})]})]})}):(0,l.jsxs)("div",{...p(),className:"flex-1 flex flex-col items-center justify-center p-8 transition-colors ".concat(g?"bg-blue-900/20 border-2 border-blue-500 border-dashed":"bg-slate-800"),children:[(0,l.jsx)("input",{...b()}),(0,l.jsx)("div",{className:"w-32 h-32 rounded-full bg-slate-700 flex items-center justify-center mb-6",children:(0,l.jsx)("span",{className:"text-6xl",children:g?"\uD83D\uDCE5":"\uD83D\uDCC4"})}),(0,l.jsx)("h3",{className:"text-2xl font-semibold text-white mb-2",children:g?"Drop file here":"Upload Document"}),(0,l.jsx)("p",{className:"text-slate-400 text-center mb-6",children:g?"Release to upload":(0,l.jsxs)(l.Fragment,{children:["Tap to select or drag and drop",(0,l.jsx)("br",{}),"Supports: JPG, PNG, PDF (up to 10MB)"]})}),(0,l.jsxs)("div",{className:"flex gap-3 text-sm text-slate-500",children:[(0,l.jsxs)("span",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{children:"✓"})," Lab Reports"]}),(0,l.jsxs)("span",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{children:"✓"})," X-rays"]}),(0,l.jsxs)("span",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{children:"✓"})," CT/MRI"]})]})]})]})}function d(){let[e,t]=(0,a.useState)(!1),[n,i]=(0,a.useState)(!1),[o,d]=(0,a.useState)(""),[x,u]=(0,a.useState)(""),m=(0,r.useRouter)(),h=async(e,l)=>{t(!0),i(!1),u(""),d("Preparing upload...");try{var a,r,n,o,c,x,h;if(console.log("[Scanner] Uploading document to API..."),!localStorage.getItem("medward_token"))throw Error("Not authenticated. Please log in first.");let t=e.type.includes("pdf")?"general":"lab";console.log("[Scanner] File details:",{name:e.name,type:e.type,size:e.size,reportType:t}),d("Processing document..."),console.log("[Scanner] Using auto-detect processing flow...");let{processDocumentAuto:u}=await s.e(205).then(s.bind(s,1205));d("OCR and AI analysis in progress...");let p=await u(e,t);console.log("[Scanner] Processing complete. Response:",{success:p.success,hasReport:!!p.report,reportId:null===(a=p.report)||void 0===a?void 0:a.id,ocrConfidence:null===(r=p.report)||void 0===r?void 0:r.ocrConfidence,extractedTextLength:null===(o=p.report)||void 0===o?void 0:null===(n=o.extractedText)||void 0===n?void 0:n.length,hasInterpretation:!!(null===(c=p.report)||void 0===c?void 0:c.interpretation),hasPearls:!!(null===(x=p.report)||void 0===x?void 0:x.clinicalPearls),hasQuestions:!!(null===(h=p.report)||void 0===h?void 0:h.potentialQuestions)});let b=JSON.parse(localStorage.getItem("medward_reports")||"[]"),g={...p.report,uploadMethod:l};b.unshift(g),localStorage.setItem("medward_reports",JSON.stringify(b));try{let{saveReportToSheets:e}=await s.e(199).then(s.bind(s,8199));e(g).then(()=>console.log("[Scanner] ✓ Report saved to Google Sheets")).catch(e=>console.warn("[Scanner] Failed to save to Google Sheets:",e.message))}catch(e){console.warn("[Scanner] Google Sheets integration not available")}d("Complete!"),i(!0),setTimeout(()=>{m.push("/reports/view/?id=".concat(p.report.id))},2e3)}catch(t){console.error("[Scanner] Error:",t),console.error("[Scanner] Error stack:",t.stack);let e=t.message;(e.includes("No text detected")||e.includes("extract text"))&&(e+="\n\nTips for better results:\n• Use good lighting\n• Hold camera steady\n• Ensure text is in focus\n• Try uploading a file instead"),e.includes("Not authenticated")&&(e+="\n\nPlease log in again to continue."),u(e),d("")}finally{t(!1)}};return(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[(0,l.jsx)("header",{className:"bg-white/80 backdrop-blur-lg border-b border-gray-200 sticky top-0 z-50 shadow-sm",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,l.jsx)("div",{className:"flex items-center justify-between",children:(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("button",{onClick:()=>m.push("/dashboard"),className:"text-gray-600 hover:text-gray-900 transition-colors",children:"← Back"}),(0,l.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg",children:(0,l.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCF7"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Scan Report"}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"Upload medical documents for analysis"})]})]})})})}),(0,l.jsxs)("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,l.jsx)("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden",children:e?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center p-12",children:[(0,l.jsx)("div",{className:"w-16 h-16 border-4 border-primary/30 border-t-primary rounded-full animate-spin mb-4"}),(0,l.jsx)("p",{className:"text-gray-900 font-medium text-lg mb-2",children:"Processing Document"}),(0,l.jsx)("p",{className:"text-gray-600 text-sm",children:o}),(0,l.jsxs)("div",{className:"mt-6 text-xs text-gray-500 text-center max-w-md",children:[(0,l.jsx)("p",{children:"This may take 10-30 seconds depending on document complexity."}),(0,l.jsx)("p",{className:"mt-2",children:"Steps: OCR → AI Analysis → Clinical Pearls → Questions"})]})]}):n?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center p-12",children:[(0,l.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:(0,l.jsx)("span",{className:"text-4xl",children:"✅"})}),(0,l.jsx)("p",{className:"text-gray-900 font-bold text-xl mb-2",children:"Analysis Complete!"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Redirecting to report..."})]}):(0,l.jsx)(c,{onCapture:h})}),x&&!e&&(0,l.jsx)("div",{className:"mt-6 bg-red-50 border-2 border-red-200 rounded-xl p-6",children:(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsx)("span",{className:"text-3xl",children:"⚠️"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-bold text-red-900 text-lg mb-2",children:"Upload Failed"}),(0,l.jsx)("p",{className:"text-red-700 whitespace-pre-wrap",children:x}),(0,l.jsx)("button",{onClick:()=>u(""),className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Try Again"})]})]})}),(0,l.jsx)("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-xl p-4",children:(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("span",{className:"text-xl",children:"\uD83D\uDCA1"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-semibold text-gray-900 mb-1",children:"Tips for Best Results"}),(0,l.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,l.jsx)("li",{children:"• Use good lighting and avoid shadows"}),(0,l.jsx)("li",{children:"• Ensure text is clear and in focus"}),(0,l.jsx)("li",{children:"• Align the document properly in the frame"}),(0,l.jsx)("li",{children:"• Supported: Lab results, imaging reports, clinical notes"}),(0,l.jsx)("li",{children:"• Formats: JPG, PNG, PDF (up to 10MB)"})]})]})]})})]})]})}}},function(e){e.O(0,[46,971,117,744],function(){return e(e.s=7900)}),_N_E=e.O()}]);