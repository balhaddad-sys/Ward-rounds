(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[673],{7900:function(e,t,s){Promise.resolve().then(s.bind(s,7190))},7190:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var l=s(7437),a=s(2265),r=s(9376),n=s(166),i=s(5725);let c=(0,n.default)(()=>s.e(785).then(s.t.bind(s,4785,23)),{loadableGenerated:{webpack:()=>[4785]},ssr:!1});function o(e){let{onCapture:t}=e,[s,r]=(0,a.useState)("camera"),[n,o]=(0,a.useState)(!1),[d,x]=(0,a.useState)(null),m=(0,a.useRef)(null),u=(0,a.useCallback)(async()=>{if(m.current){o(!0);try{let e=m.current.getScreenshot({width:1920,height:1080});if(!e)throw Error("Failed to capture image");let s=await fetch(e),l=await s.blob(),a=new File([l],"scan-".concat(Date.now(),".jpg"),{type:"image/jpeg"});t([a],"camera")}catch(e){console.error("Capture error:",e),alert("Failed to capture photo. Please try again.")}finally{o(!1)}}},[t]),h=(0,a.useCallback)(e=>{e.length>0&&t(e,"upload")},[t]),{getRootProps:p,getInputProps:g,isDragActive:b}=(0,i.uI)({onDrop:h,accept:{"image/*":[".jpeg",".jpg",".png"],"application/pdf":[".pdf"]},maxFiles:10,multiple:!0});return(0,l.jsxs)("div",{className:"flex flex-col h-full bg-slate-900",children:[(0,l.jsxs)("div",{className:"flex gap-2 p-4 bg-slate-800",children:[(0,l.jsx)("button",{onClick:()=>r("camera"),className:"flex-1 py-3 rounded-xl font-medium transition-colors ".concat("camera"===s?"bg-blue-600 text-white":"bg-slate-700 text-slate-300"),children:"\uD83D\uDCF7 Camera"}),(0,l.jsx)("button",{onClick:()=>r("upload"),className:"flex-1 py-3 rounded-xl font-medium transition-colors ".concat("upload"===s?"bg-blue-600 text-white":"bg-slate-700 text-slate-300"),children:"\uD83D\uDCC1 Upload"})]}),"camera"===s?(0,l.jsx)("div",{className:"relative flex-1 bg-black",children:d?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-white p-8",children:[(0,l.jsx)("span",{className:"text-6xl mb-4",children:"\uD83D\uDCF7"}),(0,l.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Camera Access Needed"}),(0,l.jsx)("p",{className:"text-sm text-slate-400 text-center mb-4",children:d}),(0,l.jsx)("button",{onClick:()=>r("upload"),className:"px-6 py-3 bg-blue-600 text-white rounded-xl font-medium",children:"Use File Upload Instead"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c,{ref:m,audio:!1,screenshotFormat:"image/jpeg",screenshotQuality:.95,videoConstraints:{facingMode:{ideal:"environment"},width:{ideal:1920},height:{ideal:1080}},className:"w-full h-full object-cover",onUserMediaError:e=>{console.error("Camera error:",e),x("Unable to access camera. Please check permissions or use file upload.")}}),(0,l.jsx)("div",{className:"absolute inset-0 pointer-events-none",children:(0,l.jsxs)("div",{className:"absolute inset-8 border-2 border-white/50 rounded-lg",children:[(0,l.jsx)("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 text-white text-sm bg-black/70 px-3 py-1 rounded-full whitespace-nowrap",children:"Align document within frame"}),(0,l.jsx)("div",{className:"absolute -top-1 -left-1 w-6 h-6 border-t-4 border-l-4 border-blue-500"}),(0,l.jsx)("div",{className:"absolute -top-1 -right-1 w-6 h-6 border-t-4 border-r-4 border-blue-500"}),(0,l.jsx)("div",{className:"absolute -bottom-1 -left-1 w-6 h-6 border-b-4 border-l-4 border-blue-500"}),(0,l.jsx)("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 border-b-4 border-r-4 border-blue-500"})]})}),(0,l.jsxs)("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center gap-4 items-center",children:[(0,l.jsx)("button",{className:"w-12 h-12 rounded-full bg-slate-800/80 backdrop-blur flex items-center justify-center text-white",children:"⚡"}),(0,l.jsx)("button",{onClick:u,disabled:n,className:"w-20 h-20 rounded-full bg-white border-4 border-blue-600 flex items-center justify-center shadow-2xl active:scale-95 transition-transform disabled:opacity-50",children:n?(0,l.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}):(0,l.jsx)("div",{className:"w-14 h-14 rounded-full bg-blue-600"})}),(0,l.jsx)("button",{onClick:()=>r("upload"),className:"w-12 h-12 rounded-full bg-slate-800/80 backdrop-blur flex items-center justify-center text-white",children:"\uD83D\uDDBC️"})]})]})}):(0,l.jsxs)("div",{...p(),className:"flex-1 flex flex-col items-center justify-center p-8 transition-colors ".concat(b?"bg-blue-900/20 border-2 border-blue-500 border-dashed":"bg-slate-800"),children:[(0,l.jsx)("input",{...g()}),(0,l.jsx)("div",{className:"w-32 h-32 rounded-full bg-slate-700 flex items-center justify-center mb-6",children:(0,l.jsx)("span",{className:"text-6xl",children:b?"\uD83D\uDCE5":"\uD83D\uDCC4"})}),(0,l.jsx)("h3",{className:"text-2xl font-semibold text-white mb-2",children:b?"Drop file here":"Upload Document"}),(0,l.jsx)("p",{className:"text-slate-400 text-center mb-6",children:b?"Release to upload":(0,l.jsxs)(l.Fragment,{children:["Tap to select or drag and drop",(0,l.jsx)("br",{}),(0,l.jsx)("strong",{className:"text-blue-400",children:"Multiple files supported!"}),(0,l.jsx)("br",{}),"Supports: JPG, PNG, PDF (up to 10 files, 10MB each)"]})}),(0,l.jsxs)("div",{className:"flex gap-3 text-sm text-slate-500",children:[(0,l.jsxs)("span",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{children:"✓"})," Lab Reports"]}),(0,l.jsxs)("span",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{children:"✓"})," X-rays"]}),(0,l.jsxs)("span",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{children:"✓"})," CT/MRI"]})]})]})]})}function d(){let[e,t]=(0,a.useState)(!1),[n,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(""),[x,m]=(0,a.useState)(""),[u,h]=(0,a.useState)({current:0,total:0,files:[]}),[p,g]=(0,a.useState)([]),b=(0,r.useRouter)(),f=async(e,l)=>{let a=Array.isArray(e)?e:[e];if(0===a.length){m("No files selected");return}console.log("[Scanner] Processing ".concat(a.length," file(s)...")),t(!0),i(!1),m(""),g([]),h({current:0,total:a.length,files:[]});try{if(!localStorage.getItem("medward_token"))throw Error("Not authenticated. Please log in first.");let{processDocumentAuto:e}=await s.e(205).then(s.bind(s,1205)),{preprocessImage:t}=await s.e(775).then(s.bind(s,2775)),c=[],o=JSON.parse(localStorage.getItem("medward_reports")||"[]");for(let i=0;i<a.length;i++){let x=a[i],m=i+1;console.log("[Scanner] Processing file ".concat(m,"/").concat(a.length,": ").concat(x.name)),h(e=>({...e,current:m,files:[...e.files,{name:x.name,status:"processing"}]})),d("File ".concat(m,"/").concat(a.length,": Preprocessing image..."));try{var r,n;let i=x;if(x.type.startsWith("image/")){console.log("[Scanner] Preprocessing image: ".concat(x.name));let e=await t(x);i=new File([e],x.name,{type:"image/jpeg"})}let u=x.type.includes("pdf")?"general":"lab";d("File ".concat(m,"/").concat(a.length,": OCR and AI analysis..."));let p=await e(i,u);console.log("[Scanner] File ".concat(m," complete:"),{success:p.success,reportId:null===(r=p.report)||void 0===r?void 0:r.id,hasInterpretation:!!(null===(n=p.report)||void 0===n?void 0:n.interpretation)});let g={...p.report,uploadMethod:l,fileName:x.name,processingOrder:m};c.push(g),o.unshift(g),h(e=>{let t=[...e.files];return t[t.length-1].status="complete",{...e,files:t}});try{let{saveReportToSheets:e}=await s.e(199).then(s.bind(s,8199));e(g).catch(e=>console.warn("[Scanner] Failed to save to Google Sheets:",e.message))}catch(e){console.warn("[Scanner] Google Sheets integration not available")}}catch(e){console.error("[Scanner] Error processing file ".concat(m,":"),e),h(t=>{let s=[...t.files];return s[s.length-1].status="failed",s[s.length-1].error=e.message,{...t,files:s}})}}localStorage.setItem("medward_reports",JSON.stringify(o)),g(c),d("All files processed!"),i(!0),console.log("[Scanner] Batch complete: ".concat(c.length,"/").concat(a.length," successful")),setTimeout(()=>{1===c.length?b.push("/reports/view/?id=".concat(c[0].id)):b.push("/reports")},2e3)}catch(t){console.error("[Scanner] Batch processing error:",t);let e=t.message;(e.includes("No text detected")||e.includes("extract text"))&&(e+="\n\nTips for better results:\n• Use good lighting\n• Hold camera steady\n• Ensure text is in focus\n• Take photos from directly above (not at an angle)"),e.includes("Not authenticated")&&(e+="\n\nPlease log in again to continue."),m(e),d("")}finally{t(!1)}};return(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[(0,l.jsx)("header",{className:"bg-white/80 backdrop-blur-lg border-b border-gray-200 sticky top-0 z-50 shadow-sm",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,l.jsx)("div",{className:"flex items-center justify-between",children:(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("button",{onClick:()=>b.push("/dashboard"),className:"text-gray-600 hover:text-gray-900 transition-colors",children:"← Back"}),(0,l.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg",children:(0,l.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCF7"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Scan Report"}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"Upload medical documents for analysis"})]})]})})})}),(0,l.jsxs)("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,l.jsx)("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden",children:e?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center p-12",children:[(0,l.jsx)("div",{className:"w-16 h-16 border-4 border-primary/30 border-t-primary rounded-full animate-spin mb-4"}),(0,l.jsx)("p",{className:"text-gray-900 font-medium text-lg mb-2",children:u.total>1?"Processing ".concat(u.current,"/").concat(u.total," Documents"):"Processing Document"}),(0,l.jsx)("p",{className:"text-gray-600 text-sm",children:c}),u.total>1&&(0,l.jsxs)("div",{className:"mt-6 w-full max-w-md",children:[(0,l.jsx)("div",{className:"bg-gray-200 rounded-full h-2 mb-4",children:(0,l.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(u.current/u.total*100,"%")}})}),(0,l.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:u.files.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg text-sm",children:[(0,l.jsx)("span",{className:"text-2xl",children:"complete"===e.status?"✅":"failed"===e.status?"❌":"⏳"}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"font-medium text-gray-900 truncate",children:e.name}),e.error&&(0,l.jsx)("p",{className:"text-xs text-red-600 truncate",children:e.error})]}),"processing"===e.status&&(0,l.jsx)("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})]},t))})]}),(0,l.jsxs)("div",{className:"mt-6 text-xs text-gray-500 text-center max-w-md",children:[(0,l.jsx)("p",{children:"This may take 10-30 seconds per document."}),(0,l.jsx)("p",{className:"mt-2",children:"Steps: Preprocessing → OCR → AI Analysis → Pearls → Questions"})]})]}):n?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center p-12",children:[(0,l.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:(0,l.jsx)("span",{className:"text-4xl",children:"✅"})}),(0,l.jsx)("p",{className:"text-gray-900 font-bold text-xl mb-2",children:p.length>1?"".concat(p.length," Reports Processed!"):"Analysis Complete!"}),(0,l.jsx)("p",{className:"text-gray-600",children:p.length>1?"Redirecting to reports list...":"Redirecting to report..."}),u.files.length>1&&(0,l.jsx)("div",{className:"mt-6 w-full max-w-md",children:(0,l.jsxs)("div",{className:"text-sm text-gray-700 mb-2",children:["✅ ",u.files.filter(e=>"complete"===e.status).length," successful",u.files.filter(e=>"failed"===e.status).length>0&&(0,l.jsxs)(l.Fragment,{children:[" \xb7 ❌ ",u.files.filter(e=>"failed"===e.status).length," failed"]})]})})]}):(0,l.jsx)(o,{onCapture:f})}),x&&!e&&(0,l.jsx)("div",{className:"mt-6 bg-red-50 border-2 border-red-200 rounded-xl p-6",children:(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsx)("span",{className:"text-3xl",children:"⚠️"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-bold text-red-900 text-lg mb-2",children:"Upload Failed"}),(0,l.jsx)("p",{className:"text-red-700 whitespace-pre-wrap",children:x}),(0,l.jsx)("button",{onClick:()=>m(""),className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Try Again"})]})]})}),(0,l.jsx)("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-xl p-4",children:(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("span",{className:"text-xl",children:"\uD83D\uDCA1"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-semibold text-gray-900 mb-1",children:"Tips for Best Results"}),(0,l.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("strong",{children:"Photos from any angle:"})," Auto-rotation and enhancement enabled"]}),(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("strong",{children:"Multiple uploads:"})," Select up to 10 files at once"]}),(0,l.jsx)("li",{children:"• Use good lighting and avoid shadows"}),(0,l.jsx)("li",{children:"• Ensure text is clear and in focus"}),(0,l.jsx)("li",{children:"• Supported: Lab results, imaging reports, clinical notes"}),(0,l.jsx)("li",{children:"• Formats: JPG, PNG, PDF (up to 10MB each)"})]})]})]})})]})]})}}},function(e){e.O(0,[46,971,117,744],function(){return e(e.s=7900)}),_N_E=e.O()}]);